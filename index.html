<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø­ØµØµ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ - Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…Ù„Ù‡Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #6a2df3;
            --primary-dark: #4b1fad;
            --primary-light: #8a5cf5;
            --secondary: #ff8a3c;
            --secondary-light: #ffb37c;
            --accent: #22b8aa;
            --accent-light: #5ce0d2;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            
            --purple-gradient: linear-gradient(135deg, #6a2df3, #8a5cf5);
            --orange-gradient: linear-gradient(135deg, #ff8a3c, #ffb37c);
            --teal-gradient: linear-gradient(135deg, #22b8aa, #5ce0d2);
            
            --bg-light: #f7f4ff;
            --bg-white: #ffffff;
            --text-dark: #15162b;
            --text-light: #5d6680;
            
            --radius-lg: 20px;
            --radius-md: 12px;
            --radius-sm: 8px;
            
            --shadow-soft: 0 10px 25px rgba(106, 45, 243, 0.1);
            --shadow-medium: 0 15px 35px rgba(106, 45, 243, 0.15);
            --shadow-strong: 0 20px 50px rgba(106, 45, 243, 0.2);
            
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #f7f4ff, #ffffff);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 50%;
            transform: translateX(50%);
            width: 100px;
            height: 4px;
            background: var(--purple-gradient);
            border-radius: 2px;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            text-decoration: none;
        }

        .logo-img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-soft);
            padding: 5px;
            border: 3px solid var(--primary-light);
        }

        .logo-img img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: contain;
        }

        .logo-text {
            text-align: right;
        }

        .logo-text h1 {
            font-size: 2rem;
            color: var(--primary-dark);
            margin-bottom: 5px;
            font-weight: 800;
            background: var(--purple-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-text p {
            font-size: 1rem;
            color: var(--text-light);
            font-weight: 600;
        }

        .week-badge {
            display: inline-block;
            background: var(--orange-gradient);
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: 700;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(255, 138, 60, 0.3);
        }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .registration-card {
            background: var(--bg-white);
            border-radius: var(--radius-lg);
            padding: 40px;
            box-shadow: var(--shadow-medium);
            margin-bottom: 30px;
            border: 1px solid rgba(106, 45, 243, 0.1);
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
            counter-reset: step;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 15px;
            right: 0;
            left: 0;
            height: 3px;
            background: #e5e7eb;
            z-index: 1;
        }

        .progress-bar {
            position: absolute;
            top: 15px;
            right: 0;
            height: 3px;
            background: var(--primary);
            z-index: 2;
            transition: var(--transition);
        }

        .step {
            position: relative;
            z-index: 3;
            text-align: center;
            width: 100px;
        }

        .step-icon {
            width: 36px;
            height: 36px;
            background: #e5e7eb;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            color: var(--text-light);
            font-weight: 700;
            transition: var(--transition);
        }

        .step.active .step-icon {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 15px rgba(106, 45, 243, 0.3);
        }

        .step.completed .step-icon {
            background: var(--success);
            color: white;
        }

        .step-label {
            font-size: 0.85rem;
            color: var(--text-light);
            font-weight: 600;
        }

        .step.active .step-label {
            color: var(--primary);
        }

        /* Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
        .form-step {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-step.active {
            display: block;
        }

        .form-header {
            margin-bottom: 30px;
        }

        .form-header h2 {
            color: var(--primary-dark);
            margin-bottom: 10px;
            font-size: 1.6rem;
        }

        .form-header p {
            color: var(--text-light);
            font-size: 1rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-dark);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .required::after {
            content: ' *';
            color: var(--danger);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius-md);
            font-family: 'Cairo', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--bg-white);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(106, 45, 243, 0.1);
        }

        input.error, select.error, textarea.error {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.02);
        }

        .error-message {
            color: var(--danger);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        .form-hint {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 5px;
        }

        /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­ØµØµ */
        .classes-table {
            width: 100%;
            border-collapse: collapse;
            margin: 30px 0;
            background: white;
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-soft);
        }

        .classes-table th {
            background: var(--purple-gradient);
            color: white;
            padding: 15px;
            text-align: right;
            font-weight: 700;
        }

        .classes-table td {
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
        }

        .classes-table tr:last-child td {
            border-bottom: none;
        }

        .class-item {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: var(--transition);
        }

        .class-item:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-soft);
        }

        .class-item.selected {
            border-color: var(--primary);
            background: rgba(106, 45, 243, 0.03);
        }

        .class-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .class-title {
            font-size: 1.2rem;
            color: var(--primary-dark);
            font-weight: 700;
        }

        .class-price {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--primary);
        }

        .class-details {
            color: var(--text-light);
            margin: 10px 0;
        }

        .class-details i {
            color: var(--primary);
            margin-left: 5px;
        }

        .class-teacher {
            background: rgba(106, 45, 243, 0.1);
            padding: 8px 15px;
            border-radius: var(--radius-sm);
            display: inline-block;
            color: var(--primary-dark);
            font-weight: 600;
        }

        /* Ø¹Ø±Ø¶ Ø§Ù„Ø­ØµØµ */
        .offer-card {
            background: linear-gradient(135deg, rgba(106, 45, 243, 0.05), rgba(255, 138, 60, 0.05));
            border: 2px solid var(--primary);
            border-radius: var(--radius-lg);
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }

        .offer-title {
            font-size: 1.5rem;
            color: var(--primary-dark);
            margin-bottom: 15px;
            font-weight: 800;
        }

        .offer-price {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin: 20px 0;
        }

        .offer-price span {
            font-size: 1.2rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .offer-savings {
            background: var(--orange-gradient);
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            display: inline-block;
            font-weight: 700;
            margin-top: 10px;
        }

        /* Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù */
        .upload-area {
            border: 3px dashed #e5e7eb;
            border-radius: var(--radius-lg);
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin: 20px 0;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: rgba(106, 45, 243, 0.02);
        }

        .upload-area.dragover {
            border-color: var(--primary);
            background: rgba(106, 45, 243, 0.05);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .upload-text {
            color: var(--text-dark);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .upload-hint {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .file-preview {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(106, 45, 243, 0.05);
            padding: 15px;
            border-radius: var(--radius-md);
            margin-top: 15px;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-icon {
            color: var(--primary);
            font-size: 1.5rem;
        }

        .file-name {
            font-weight: 600;
            color: var(--text-dark);
        }

        .file-size {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .file-remove {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* Ø§Ù„Ù…Ù„Ø®Øµ */
        .summary-card {
            background: var(--bg-light);
            border-radius: var(--radius-md);
            padding: 25px;
            margin-bottom: 20px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .summary-item:last-child {
            border-bottom: none;
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
        }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .form-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            gap: 15px;
        }

        .btn {
            padding: 14px 30px;
            border-radius: var(--radius-md);
            border: none;
            font-family: 'Cairo', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--purple-gradient);
            color: white;
            box-shadow: var(--shadow-soft);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .btn-secondary {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: rgba(106, 45, 243, 0.05);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #0da271;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-disabled {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
        }

        .btn-disabled:hover {
            transform: none;
        }

        /* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .message {
            padding: 20px;
            border-radius: var(--radius-md);
            margin: 20px 0;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .message.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .message.warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .message.info {
            background: rgba(106, 45, 243, 0.1);
            border: 1px solid rgba(106, 45, 243, 0.2);
            color: var(--primary);
        }

        /* Ø§Ù„ÙÙˆØªØ± */
        .footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .contact-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(106, 45, 243, 0.05);
            padding: 10px 20px;
            border-radius: var(--radius-md);
        }

        .contact-item i {
            color: var(--primary);
        }

        .transfer-info {
            background: rgba(255, 138, 60, 0.1);
            border: 2px solid var(--secondary);
            border-radius: var(--radius-lg);
            padding: 25px;
            margin: 20px 0;
            text-align: center;
        }

        .transfer-number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-dark);
            margin: 15px 0;
            direction: ltr;
        }

        /* Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loader {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #e5e7eb;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù†ØªØ§Ø¦Ø¬ */
        .success-message {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid var(--success);
            border-radius: var(--radius-lg);
            padding: 30px;
            text-align: center;
            margin: 20px 0;
        }
        
        .success-icon {
            font-size: 4rem;
            color: var(--success);
            margin-bottom: 15px;
        }
        
        .reference-id {
            background: white;
            padding: 15px;
            border-radius: var(--radius-md);
            margin: 20px 0;
            border: 2px dashed var(--success);
            font-size: 1.2rem;
        }
        
        .reference-id strong {
            color: var(--text-dark);
            font-size: 1.4rem;
            direction: ltr;
            display: block;
            margin-top: 5px;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .registration-result {
            display: none;
        }
        
        #checkPreviousBtn {
            margin: 20px auto;
            display: block;
            max-width: 300px;
        }
        
        #registrationResult, #registrationStatus {
            margin: 20px 0;
        }

        /* Ø´Ø±ÙŠØ· Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ */
        .connection-status {
            padding: 10px 15px;
            border-radius: var(--radius-md);
            margin: 10px 0;
            text-align: center;
            display: none;
        }
        
        .connection-status.connected {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }
        
        .connection-status.disconnected {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--warning);
            color: var(--warning);
        }

        /* Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨Ø© */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .registration-card {
                padding: 25px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .progress-steps {
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
            }
            
            .form-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .class-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .contact-info {
                flex-direction: column;
                align-items: center;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-buttons .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ø´Ø±ÙŠØ· Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ -->
        <div id="connectionStatus" class="connection-status">
            <i class="fas fa-wifi"></i>
            <span id="connectionText">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>
        </div>

        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <div class="header">
            <div class="logo">
                <div class="logo-img">
                    <img src="https://h.top4top.io/p_3622qldhs1.png" alt="Ø´Ø¹Ø§Ø± Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…Ù„Ù‡Ù…">
                </div>
                <div class="logo-text">
                    <h1>Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…Ù„Ù‡Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</h1>
                    <p>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„Ø­ØµØµ Ø§Ù„Ø­Ø¶ÙˆØ±ÙŠØ©</p>
                    <div class="week-badge">Ø­ØµØµ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ÙÙ‚Ø·</div>
                </div>
            </div>
        </div>

        <!-- Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙ‚Ø¯Ù… -->
        <div class="progress-steps">
            <div class="progress-bar" id="progressBar"></div>
            <div class="step active" data-step="1">
                <div class="step-icon">1</div>
                <div class="step-label">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</div>
            </div>
            <div class="step" data-step="2">
                <div class="step-icon">2</div>
                <div class="step-label">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­ØµØµ</div>
            </div>
            <div class="step" data-step="3">
                <div class="step-icon">3</div>
                <div class="step-label">Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø§Ù„ÙŠ</div>
            </div>
            <div class="step" data-step="4">
                <div class="step-icon">4</div>
                <div class="step-label">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</div>
            </div>
        </div>

        <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… -->
        <div class="message success" id="successMessage">
            <i class="fas fa-check-circle"></i>
            <span id="successText"></span>
        </div>

        <div class="message error" id="errorMessage">
            <i class="fas fa-exclamation-circle"></i>
            <span id="errorText"></span>
        </div>

        <div class="message info" id="infoMessage">
            <i class="fas fa-info-circle"></i>
            <span id="infoText"></span>
        </div>

        <!-- Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ -->
        <div class="registration-card">
            <!-- Ø§Ù„Ø®Ø·ÙˆØ© 1: Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ -->
            <div class="form-step active" id="step1">
                <div class="form-header">
                    <h2>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
                    <p>ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ ÙƒØ§Ù…Ù„Ø© Ù„Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø­Ø¶ÙˆØ±ÙŠØ©</p>
                </div>

                <div class="transfer-info">
                    <h3><i class="fas fa-info-circle"></i> Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø©</h3>
                    <p>Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…ØªØ§Ø­ ÙÙ‚Ø· Ù„Ù„Ø­ØµØµ Ø§Ù„Ø­Ø¶ÙˆØ±ÙŠØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:</p>
                    <ul style="list-style: none; margin: 15px 0; text-align: right;">
                        <li>ğŸ“ Ø§Ù„Ø¬Ù…Ø¹Ø©: Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ (4:00 - 5:30 Ø¹ØµØ±Ø§Ù‹)</li>
                        <li>ğŸ“ Ø§Ù„Ø¬Ù…Ø¹Ø©: Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ (6:00 - 7:30 Ù…Ø³Ø§Ø¡Ù‹)</li>
                        <li>ğŸ“ Ø§Ù„Ø³Ø¨Øª: Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© (9:00 - 10:30 ØµØ¨Ø§Ø­Ø§Ù‹)</li>
                        <li>ğŸ“ Ø§Ù„Ø³Ø¨Øª: Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ (11:00 - 12:30 Ø¸Ù‡Ø±Ø§Ù‹)</li>
                    </ul>
                </div>

                <form id="basicInfoForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="studentName" class="required">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ ÙƒØ§Ù…Ù„Ø§Ù‹</label>
                            <input type="text" id="studentName" name="studentName" 
                                   placeholder=" Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ ÙˆØ§Ù„Ù‚Ø¨ÙŠÙ„Ø©" required>
                            <div class="error-message" id="studentNameError"></div>
                        </div>

                        <div class="form-group">
                            <label for="grade" class="required">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
                            <select id="grade" name="grade" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
                                <option value="Ø§Ù„Ø³Ø§Ø¯Ø³">Ø§Ù„Ø³Ø§Ø¯Ø³</option>
                                <option value="Ø§Ù„Ø³Ø§Ø¨Ø¹">Ø§Ù„Ø³Ø§Ø¨Ø¹</option>
                                <option value="Ø§Ù„Ø«Ø§Ù…Ù†">Ø§Ù„Ø«Ø§Ù…Ù†</option>
                                <option value="Ø§Ù„ØªØ§Ø³Ø¹">Ø§Ù„ØªØ§Ø³Ø¹</option>
                                <option value="Ø§Ù„Ø¹Ø§Ø´Ø±">Ø§Ù„Ø¹Ø§Ø´Ø±</option>
                                <option value="Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±">Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±</option>
                                <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±</option>
                            </select>
                            <div class="error-message" id="gradeError"></div>
                        </div>

                        <div class="form-group">
                            <label for="phone" class="required">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (ÙˆØ§ØªØ³Ø§Ø¨)</label>
                            <input type="tel" id="phone" name="phone" 
                                   placeholder="Ù…Ø«Ø§Ù„: 95xxxxx9" required>
                            <div class="error-message" id="phoneError"></div>
                            <div class="form-hint">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</div>
                        </div>

                        <div class="form-group">
                            <label for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input type="email" id="email" name="email" 
                                   placeholder="example@email.com">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <textarea id="notes" name="notes" rows="3" 
                                  placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£Ùˆ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª ØªØ¹Ù„ÙŠÙ…ÙŠØ©..."></textarea>
                    </div>

                    <div class="form-buttons">
                        <button type="button" class="btn btn-secondary" disabled>Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                        <button type="button" class="btn btn-primary" onclick="nextStep(1)">
                            Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­ØµØµ -->
            <div class="form-step" id="step2">
                <div class="form-header">
                    <h2>Ø§Ø®ØªØ± Ø§Ù„Ø­ØµØµ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠÙ‡Ø§</h2>
                    <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø­ØµØ© ÙˆØ§Ø­Ø¯Ø© Ø£Ùˆ Ø§Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø§Øµ</p>
                </div>

                <!-- Ø¹Ø±Ø¶ 4 Ø­ØµØµ -->
                <div class="offer-card">
                    <div class="offer-title">ğŸ Ø¹Ø±Ø¶ Ø®Ø§Øµ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div>
                    <p>Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ 4 Ø­ØµØµ Ø¨Ø³Ø¹Ø± 3 Ø­ØµØµ ÙÙ‚Ø·!</p>
                    <div class="offer-price">15 <span>Ø±ÙŠØ§Ù„ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 20 Ø±ÙŠØ§Ù„</span></div>
                    <div class="offer-savings">ØªÙˆÙÙŠØ± 5 Ø±ÙŠØ§Ù„Ø§Øª</div>
                </div>

                <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­ØµØµ -->
                <h3 style="color: var(--primary-dark); margin: 30px 0 15px;">Ø§Ù„Ø­ØµØµ Ø§Ù„Ù…ØªØ§Ø­Ø©:</h3>

                <!-- Ø§Ù„Ø¬Ù…Ø¹Ø© -->
                <h4 style="color: var(--primary); margin: 20px 0 10px; border-right: 4px solid var(--primary); padding-right: 10px;">
                    <i class="far fa-calendar-alt"></i> ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø©
                </h4>

                <!-- Ø­ØµØ© Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ -->
                <div class="class-item" onclick="selectClass('chemistry', 5)">
                    <div class="class-header">
                        <div class="class-title">Ù…Ø§Ø¯Ø© Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡</div>
                        <div class="class-price">5 Ø±ÙŠØ§Ù„</div>
                    </div>
                    <div class="class-details">
                        <i class="far fa-clock"></i> Ø§Ù„ÙˆÙ‚Øª: 4:00 - 5:30 Ø¹ØµØ±Ø§Ù‹
                    </div>
                    <div class="class-details">
                        <i class="fas fa-user-tie"></i> Ø§Ù„Ù…Ø¹Ù„Ù…: Ø§Ù„Ø£Ø³ØªØ§Ø° Ø£Ø­Ù…Ø¯ Ø§Ù„Ù…Ø¹Ù…Ø±ÙŠ
                    </div>
                    <div class="class-teacher">
                        <i class="fas fa-chalkboard-teacher"></i> Ø­ØµØ© Ø­Ø¶ÙˆØ±ÙŠØ©
                    </div>
                </div>

                <!-- Ø­ØµØ© Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ -->
                <div class="class-item" onclick="selectClass('biology', 5)">
                    <div class="class-header">
                        <div class="class-title">Ù…Ø§Ø¯Ø© Ø§Ù„Ø£Ø­ÙŠØ§Ø¡</div>
                        <div class="class-price">5 Ø±ÙŠØ§Ù„</div>
                    </div>
                    <div class="class-details">
                        <i class="far fa-clock"></i> Ø§Ù„ÙˆÙ‚Øª: 6:00 - 7:30 Ù…Ø³Ø§Ø¡Ù‹
                    </div>
                    <div class="class-details">
                        <i class="fas fa-user-tie"></i> Ø§Ù„Ù…Ø¹Ù„Ù…: Ø§Ù„Ø£Ø³ØªØ§Ø° Ø­Ù…ÙŠØ± Ø§Ù„Ù…Ù†Ø°Ø±ÙŠ
                    </div>
                    <div class="class-teacher">
                        <i class="fas fa-chalkboard-teacher"></i> Ø­ØµØ© Ø­Ø¶ÙˆØ±ÙŠØ©
                    </div>
                </div>

                <!-- Ø§Ù„Ø³Ø¨Øª -->
                <h4 style="color: var(--primary); margin: 20px 0 10px; border-right: 4px solid var(--primary); padding-right: 10px;">
                    <i class="far fa-calendar-alt"></i> ÙŠÙˆÙ… Ø§Ù„Ø³Ø¨Øª
                </h4>

                <!-- Ø­ØµØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© -->
                <div class="class-item" onclick="selectClass('english', 5)">
                    <div class="class-header">
                        <div class="class-title">Ù…Ø§Ø¯Ø© Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</div>
                        <div class="class-price">5 Ø±ÙŠØ§Ù„</div>
                    </div>
                    <div class="class-details">
                        <i class="far fa-clock"></i> Ø§Ù„ÙˆÙ‚Øª: 9:00 - 10:30 ØµØ¨Ø§Ø­Ø§Ù‹
                    </div>
                    <div class="class-details">
                        <i class="fas fa-user-tie"></i> Ø§Ù„Ù…Ø¹Ù„Ù…: Ø§Ù„Ø£Ø³ØªØ§Ø° Ù†Ø§ØµØ± Ø§Ù„Ù…Ù†Ø¸Ø±ÙŠ
                    </div>
                    <div class="class-teacher">
                        <i class="fas fa-chalkboard-teacher"></i> Ø­ØµØ© Ø­Ø¶ÙˆØ±ÙŠØ©
                    </div>
                </div>

                <!-- Ø­ØµØ© Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ -->
                <div class="class-item" onclick="selectClass('physics', 5)">
                    <div class="class-header">
                        <div class="class-title">Ù…Ø§Ø¯Ø© Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡</div>
                        <div class="class-price">5 Ø±ÙŠØ§Ù„</div>
                    </div>
                    <div class="class-details">
                        <i class="far fa-clock"></i> Ø§Ù„ÙˆÙ‚Øª: 11:00 - 12:30 Ø¸Ù‡Ø±Ø§Ù‹
                    </div>
                    <div class="class-details">
                        <i class="fas fa-user-tie"></i> Ø§Ù„Ù…Ø¹Ù„Ù…: Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¨Ø¯Ø± Ø§Ù„Ø¹Ø¨Ø±ÙŠ
                    </div>
                    <div class="class-teacher">
                        <i class="fas fa-chalkboard-teacher"></i> Ø­ØµØ© Ø­Ø¶ÙˆØ±ÙŠØ©
                    </div>
                </div>

                <div class="summary-card" style="margin-top: 30px;">
                    <h3 style="color: var(--primary-dark); margin-bottom: 15px;">Ù…Ù„Ø®Øµ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª</h3>
                    <div class="summary-item">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</span>
                        <span id="selectedCount">0</span>
                    </div>
                    <div class="summary-item">
                        <span>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                        <span id="calculatedAmount">0 Ø±ÙŠØ§Ù„</span>
                    </div>
                    <div class="summary-item" id="discountInfo" style="display: none;">
                        <span>Ø§Ù„Ø®ØµÙ…:</span>
                        <span style="color: var(--success);">-5 Ø±ÙŠØ§Ù„</span>
                    </div>
                    <div class="summary-item">
                        <span>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>
                        <span id="finalAmount" style="font-weight: 700; color: var(--primary);">0 Ø±ÙŠØ§Ù„</span>
                    </div>
                </div>

                <div class="form-buttons">
                    <button type="button" class="btn btn-secondary" onclick="prevStep(2)">
                        <i class="fas fa-arrow-right"></i> Ø§Ù„Ø³Ø§Ø¨Ù‚
                    </button>
                    <button type="button" class="btn btn-primary" onclick="nextStep(2)">
                        Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
            </div>

            <!-- Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø§Ù„ÙŠ -->
            <div class="form-step" id="step3">
                <div class="form-header">
                    <h2>Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø§Ù„ÙŠ</h2>
                    <p>Ù‚Ù… Ø¨Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ Ø«Ù… Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„</p>
                </div>

                <div class="transfer-info">
                    <h3><i class="fas fa-money-bill-wave"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„</h3>
                    <p>ÙŠØ±Ø¬Ù‰ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ:</p>
                    <div class="transfer-number">92147179</div>
                    <p>Ø«Ù… Ù‚Ù… Ø¨Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø£Ø¯Ù†Ø§Ù‡</p>
                    <p style="color: var(--warning); margin-top: 10px;">
                        <i class="fas fa-exclamation-triangle"></i> ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù‚Ø¨Ù„ Ø±ÙØ¹ Ø§Ù„Ø¥ÙŠØµØ§Ù„
                    </p>
                </div>

                <div class="form-group">
                    <label class="required">Ø±ÙØ¹ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„</label>
                    <div class="upload-area" id="uploadArea" onclick="document.getElementById('receiptFile').click()">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="upload-text">Ø§Ù†Ù‚Ø± Ù„Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„</div>
                        <div class="upload-hint">ÙŠÙØ³Ù…Ø­ Ø¨Ø§Ù„ØµÙŠØº: JPG, PNG, PDF (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: 5MB)</div>
                    </div>
                    <input type="file" id="receiptFile" name="receiptFile" 
                           accept="image/*,.pdf" style="display: none;" 
                           onchange="handleFileUpload(this.files)">
                    <div class="error-message" id="receiptError"></div>
                </div>

                <div id="filePreview" style="display: none;">
                    <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§ -->
                </div>

                <div class="form-hint" style="background: rgba(245, 158, 11, 0.1); padding: 15px; border-radius: var(--radius-md);">
                    <h4 style="color: var(--warning); margin-bottom: 10px;"><i class="fas fa-exclamation-triangle"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©:</h4>
                    <p>1. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† ØµÙˆØ±Ø© Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„ ÙˆØ§Ø¶Ø­Ø© ÙˆØªØ¸Ù‡Ø± Ø±Ù‚Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®</p>
                    <p>2. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ØµØ­ÙŠØ­ ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ø¨ÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ù„Ø®Øµ</p>
                    <p>3. Ø³ØªØµÙ„Ùƒ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©</p>
                    <p>4. Ø±Ù‚Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„: <strong>92147179</strong></p>
                </div>

                <div class="form-buttons">
                    <button type="button" class="btn btn-secondary" onclick="prevStep(3)">
                        <i class="fas fa-arrow-right"></i> Ø§Ù„Ø³Ø§Ø¨Ù‚
                    </button>
                    <button type="button" class="btn btn-primary" onclick="nextStep(3)">
                        Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
            </div>

            <!-- Ø§Ù„Ø®Ø·ÙˆØ© 4: ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
            <div class="form-step" id="step4">
                <div class="form-header">
                    <h2>ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</h2>
                    <p>ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù‚Ø¨Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</p>
                </div>

                <!-- Ù…Ù†Ø·Ù‚Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
                <div id="registrationResult" class="registration-result"></div>
                <div id="registrationStatus"></div>

                <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„) -->
                <div id="summaryBeforeSubmit">
                    <div class="summary-card">
                        <h3 style="color: var(--primary-dark); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-clipboard-check"></i> Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨
                        </h3>
                        
                        <div class="summary-item">
                            <span>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</span>
                            <span id="summaryName">-</span>
                        </div>
                        <div class="summary-item">
                            <span>Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ:</span>
                            <span id="summaryGrade">-</span>
                        </div>
                        <div class="summary-item">
                            <span>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</span>
                            <span id="summaryPhone">-</span>
                        </div>
                        <div class="summary-item">
                            <span>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</span>
                            <span id="summaryEmail">-</span>
                        </div>
                        <div class="summary-item" style="border-top: 2px solid var(--primary-light); padding-top: 15px; margin-top: 10px;">
                            <span>Ø§Ù„Ø­ØµØµ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</span>
                            <span id="summaryClasses">-</span>
                        </div>
                        <div class="summary-item">
                            <span>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                            <span id="summaryTotal">-</span>
                        </div>
                        <div class="summary-item">
                            <span>Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…:</span>
                            <span id="summaryFinal" style="font-weight: 700; color: var(--primary);">-</span>
                        </div>
                        <div class="summary-item" style="border-top: 2px solid var(--primary-light); padding-top: 15px; margin-top: 10px;">
                            <span>Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„:</span>
                            <span id="summaryPayment" style="color: var(--success);">âœ“ Ù…Ø±ÙÙˆØ¹</span>
                        </div>
                    </div>

                    <!-- Ø´Ø±ÙˆØ· ÙˆØ£Ø­ÙƒØ§Ù… -->
                    <div class="form-group" style="margin: 30px 0;">
                        <div style="background: rgba(106, 45, 243, 0.05); padding: 20px; border-radius: var(--radius-md);">
                            <h4 style="color: var(--primary-dark); margin-bottom: 15px;">Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…:</h4>
                            <ul style="list-style: none; margin-right: 10px; color: var(--text-light);">
                                <li style="margin-bottom: 8px;"><i class="fas fa-check-circle" style="color: var(--accent); margin-left: 8px;"></i> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ØµØµ Ø­Ø¶ÙˆØ±ÙŠØ© ÙÙŠ Ù…Ù‚Ø± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</li>
                                <li style="margin-bottom: 8px;"><i class="fas fa-check-circle" style="color: var(--accent); margin-left: 8px;"></i> Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù†Ù‡Ø§Ø¦ÙŠ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯</li>
                                <li style="margin-bottom: 8px;"><i class="fas fa-check-circle" style="color: var(--accent); margin-left: 8px;"></i> ÙŠÙ„ØªØ²Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ø§Ù„Ø­Ø¶ÙˆØ± ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯</li>
                                <li style="margin-bottom: 8px;"><i class="fas fa-check-circle" style="color: var(--accent); margin-left: 8px;"></i> ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¹Ù„Ù… Ø£Ùˆ Ø§Ù„ÙˆÙ‚Øª Ø­Ø³Ø¨ Ø§Ù„Ø¸Ø±ÙˆÙ</li>
                            </ul>
                        </div>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="agreeTerms" name="agreeTerms" style="width: auto;">
                            <span>Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø© Ø£Ø¹Ù„Ø§Ù‡</span>
                        </label>
                        <div class="error-message" id="termsError"></div>
                    </div>

                    <!-- Ù…Ø­Ù…Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
                    <div class="loader" id="loader">
                        <div class="loader-spinner"></div>
                        <p id="loaderText">Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...</p>
                    </div>

                    <div class="form-buttons">
                        <button type="button" class="btn btn-secondary" onclick="prevStep(4)">
                            <i class="fas fa-arrow-right"></i> Ø§Ù„Ø³Ø§Ø¨Ù‚
                        </button>
                        <button type="button" class="btn btn-success" onclick="submitRegistration()" id="submitBtn">
                            <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Google Sheets
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø²Ø± Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¨Ù‚ -->
        <button id="checkPreviousBtn" class="btn btn-secondary" onclick="showCheckRegistrationModal()">
            <i class="fas fa-search"></i> Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¨Ù‚
        </button>

        <!-- Ø²Ø± Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ -->
        <button id="testConnectionBtn" class="btn btn-warning" onclick="testGoogleSheetsConnection()" style="margin: 10px auto; display: block;">
            <i class="fas fa-wifi"></i> Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ Google Sheets
        </button>

        <!-- Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
        <div class="footer">
            <div class="contact-info">
                <div class="contact-item">
                    <i class="fas fa-phone-alt"></i>
                    <span>Ù„Ù„ØªÙˆØ§ØµÙ„: 74120010</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Ø±Ù‚Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„: 92147179</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©: Ø¹Ø¨Ø±ÙŠØŒ Ø§Ù„Ø¯Ø±ÙŠØ²</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-clock"></i>
                    <span>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„: 8 ØµØ¨Ø§Ø­Ø§Ù‹ - 10 Ù…Ø³Ø§Ø¡Ù‹</span>
                </div>
            </div>
            
            <p style="margin-top: 20px;">
                Â© 2025 Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…Ù„Ù‡Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
                <br>
                Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± 2.0 | Ù…ØªØµÙ„ Ø¨Ù€ Google Sheets
            </p>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
    <div id="checkModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; box-shadow: 0 20px 50px rgba(0,0,0,0.2);">
            <h3 style="color: #6a2df3; margin-bottom: 20px;">
                <i class="fas fa-search"></i> Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            </h3>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; color: #666;">
                    Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹:
                </label>
                <input type="text" id="referenceInput" 
                       placeholder="Ù…Ø«Ø§Ù„: MUL-123456789" 
                       style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px;">
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 25px;">
                <button onclick="checkReference()" 
                        class="btn btn-primary"
                        style="flex: 1;">
                    <i class="fas fa-search"></i> Ø¨Ø­Ø«
                </button>
                <button onclick="closeModal()" 
                        class="btn btn-secondary"
                        style="flex: 1;">
                    <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                </button>
            </div>
            
            <div id="modalResult" style="margin-top: 20px;"></div>
        </div>
    </div>

    <script>
        // ============================================
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Google Apps Script
        // ============================================
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzqxe1YtL1TDEB9-SM_eV68Ng3mIxJWJV_WUAoSAOk6YFRPEpigSNN4CcnNC7_VRtpN/exec';

        // ============================================
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        // ============================================
        let currentStep = 1;
        let selectedClasses = [];
        let uploadedFile = null;
        let formData = {
            studentInfo: {},
            classes: [],
            payment: {}
        };
        let googleSheetsConnected = false;

        // ============================================
        // ÙƒØ§Ø¦Ù† API Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Google Sheets
        // ============================================
     // ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØŒ Ø¹Ø¯Ù‘Ù„ Ø¯Ø§Ù„Ø© testConnection ÙÙŠ ÙƒØ§Ø¦Ù† GoogleSheetsAPI
const GoogleSheetsAPI = {
    // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Google Sheets
    async testConnection() {
        try {
            // Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ CORS
            const url = `${GOOGLE_SCRIPT_URL}?action=test_connection&t=${Date.now()}`;
            
            // Ø§Ø³ØªØ®Ø¯Ù… fetch Ù…Ø¹ mode 'cors' Ùˆ headers Ø¨Ø³ÙŠØ·Ø©
            const response = await fetch(url, {
                method: 'GET',
                mode: 'cors',
                headers: {
                    'Accept': 'application/json'
                }
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            return data;
        } catch (error) {
            console.error('Connection test failed:', error);
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¯ÙŠÙ„Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… JSONP
            return new Promise((resolve) => {
                const callbackName = 'jsonp_callback_' + Date.now();
                window[callbackName] = function(data) {
                    delete window[callbackName];
                    document.body.removeChild(script);
                    resolve(data);
                };
                
                const script = document.createElement('script');
                script.src = `${GOOGLE_SCRIPT_URL}?action=test_connection&callback=${callbackName}&t=${Date.now()}`;
                document.body.appendChild(script);
                
                // Ø¥Ø°Ø§ ÙØ´Ù„ JSONP
                setTimeout(() => {
                    if (window[callbackName]) {
                        delete window[callbackName];
                        document.body.removeChild(script);
                        resolve({
                            success: false,
                            error: 'Connection timeout',
                            message: 'ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Google Sheets'
                        });
                    }
                }, 5000);
            });
        }
    },

    // Ø¥Ø±Ø³Ø§Ù„ ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
    async submitRegistration(formData) {
        try {
            // Ø§Ø³ØªØ®Ø¯Ù… FormData Ù„Ù„Ø¥Ø±Ø³Ø§Ù„
            const formPayload = new FormData();
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ€ JSON string
            const payload = {
                action: 'submit_registration',
                student_name: formData.student_name,
                grade: formData.grade,
                phone: formData.phone,
                email: formData.email || '',
                notes: formData.notes || '',
                selected_classes: formData.selected_classes,
                total_amount: formData.total_amount,
                discount: formData.discount || 0,
                final_amount: formData.final_amount,
                payment_file: formData.payment_file || '',
                send_notification: true
            };
            
            formPayload.append('data', JSON.stringify(payload));
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… fetch Ù…Ø¹ mode 'no-cors' Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
            const response = await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                body: formPayload,
                mode: 'no-cors' // Ù‡Ø°Ø§ Ù…Ù‡Ù… Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ CORS
            });
            
            // Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ Ù†Ø³ØªØ®Ø¯Ù… no-corsØŒ Ù„Ù† Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø±Ø¯
            // Ù„Ø°Ø§ Ù†Ø¹ÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­ Ø§ÙØªØ±Ø§Ø¶ÙŠ
            return {
                success: true,
                message: 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheets',
                reference_id: 'MUL-GS-' + Date.now() + '-' + Math.floor(Math.random() * 1000)
            };
            
        } catch (error) {
            console.error('Error submitting to Google Sheets:', error);
            return {
                success: false,
                error: error.toString(),
                message: 'ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Google Sheets'
            };
        }
    },

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
    async checkRegistration(referenceId) {
        try {
            const url = `${GOOGLE_SCRIPT_URL}?action=check_registration&reference_id=${referenceId}&t=${Date.now()}`;
            
            const response = await fetch(url, {
                method: 'GET',
                mode: 'cors',
                headers: {
                    'Accept': 'application/json'
                }
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            return data;
            
        } catch (error) {
            console.error('Error checking registration:', error);
            return {
                success: false,
                error: error.toString(),
                message: 'ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„'
            };
        }
    }
};
        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø®Ø·ÙˆØ§Øª
        // ============================================
        function updateProgressBar() {
            const progressBar = document.getElementById('progressBar');
            const steps = document.querySelectorAll('.step');
            
            const progressPercent = ((currentStep - 1) / (steps.length - 1)) * 100;
            progressBar.style.width = `${progressPercent}%`;
            
            steps.forEach(step => {
                const stepNum = parseInt(step.dataset.step);
                step.classList.remove('active', 'completed');
                
                if (stepNum < currentStep) {
                    step.classList.add('completed');
                    step.querySelector('.step-icon').innerHTML = '<i class="fas fa-check"></i>';
                } else if (stepNum === currentStep) {
                    step.classList.add('active');
                }
            });
        }

        function showStep(stepNumber) {
            document.querySelectorAll('.form-step').forEach(step => {
                step.classList.remove('active');
            });
            
            document.getElementById(`step${stepNumber}`).classList.add('active');
            currentStep = stepNumber;
            updateProgressBar();
            
            if (stepNumber === 4) {
                fillSummary();
            }
        }

        function nextStep(current) {
            if (validateStep(current)) {
                if (current === 1) {
                    saveStudentInfo();
                }
                showStep(current + 1);
            }
        }

        function prevStep(current) {
            showStep(current - 1);
        }

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµØ­Ø©
        // ============================================
        function validateStep(step) {
            let isValid = true;
            
            document.querySelectorAll('.error-message').forEach(error => {
                error.style.display = 'none';
            });
            
            document.querySelectorAll('input, select, textarea').forEach(field => {
                field.classList.remove('error');
            });

            if (step === 1) {
                const name = document.getElementById('studentName').value.trim();
                const grade = document.getElementById('grade').value;
                const phone = document.getElementById('phone').value.trim();
                
                if (!name) {
                    showError('studentNameError', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨');
                    document.getElementById('studentName').classList.add('error');
                    isValid = false;
                }
                
                if (!grade) {
                    showError('gradeError', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ');
                    document.getElementById('grade').classList.add('error');
                    isValid = false;
                }
                
                if (!phone) {
                    showError('phoneError', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ');
                    document.getElementById('phone').classList.add('error');
                    isValid = false;
                } else if (!/^\d{8}$/.test(phone)) {
                    showError('phoneError', 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 8 Ø£Ø±Ù‚Ø§Ù…');
                    document.getElementById('phone').classList.add('error');
                    isValid = false;
                }
            }
            
            if (step === 2) {
                if (selectedClasses.length === 0) {
                    showMessage('error', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø­ØµØ© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                    isValid = false;
                }
            }
            
            if (step === 3) {
                if (!uploadedFile) {
                    showError('receiptError', 'ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„');
                    isValid = false;
                }
            }
            
            return isValid;
        }

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        // ============================================
        function saveStudentInfo() {
            formData.studentInfo = {
                name: document.getElementById('studentName').value.trim(),
                grade: document.getElementById('grade').value,
                phone: document.getElementById('phone').value.trim(),
                email: document.getElementById('email').value.trim(),
                notes: document.getElementById('notes').value.trim()
            };
        }

        function selectClass(className, price) {
            const classElement = event.currentTarget;
            const classIndex = selectedClasses.findIndex(c => c.name === className);
            
            if (classIndex === -1) {
                selectedClasses.push({
                    name: className,
                    price: price,
                    title: getClassTitle(className)
                });
                classElement.classList.add('selected');
            } else {
                selectedClasses.splice(classIndex, 1);
                classElement.classList.remove('selected');
            }
            
            updateClassSummary();
        }

        function getClassTitle(className) {
            const titles = {
                'chemistry': 'Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡',
                'biology': 'Ø§Ù„Ø£Ø­ÙŠØ§Ø¡',
                'english': 'Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©',
                'physics': 'Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡'
            };
            return titles[className] || className;
        }

        function updateClassSummary() {
            const count = selectedClasses.length;
            let total = count * 5;
            let final = total;
            let discount = 0;
            
            if (count >= 4) {
                discount = 5;
                final = total - discount;
            }
            
            document.getElementById('selectedCount').textContent = count;
            document.getElementById('calculatedAmount').textContent = `${total} Ø±ÙŠØ§Ù„`;
            document.getElementById('finalAmount').textContent = `${final} Ø±ÙŠØ§Ù„`;
            
            const discountInfo = document.getElementById('discountInfo');
            if (count >= 4) {
                discountInfo.style.display = 'flex';
            } else {
                discountInfo.style.display = 'none';
            }
            
            formData.classes = selectedClasses;
            formData.totalAmount = total;
            formData.finalAmount = final;
            formData.discount = discount;
        }

        function fillSummary() {
            document.getElementById('summaryName').textContent = formData.studentInfo.name || '-';
            document.getElementById('summaryGrade').textContent = formData.studentInfo.grade || '-';
            document.getElementById('summaryPhone').textContent = formData.studentInfo.phone || '-';
            document.getElementById('summaryEmail').textContent = formData.studentInfo.email || 'Ù„Ù… ÙŠØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡';
            
            if (formData.classes.length > 0) {
                const classNames = formData.classes.map(c => c.title).join('ØŒ ');
                document.getElementById('summaryClasses').textContent = classNames;
            }
            
            document.getElementById('summaryTotal').textContent = `${formData.totalAmount || 0} Ø±ÙŠØ§Ù„`;
            document.getElementById('summaryFinal').textContent = `${formData.finalAmount || 0} Ø±ÙŠØ§Ù„`;
        }

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
        // ============================================
        function handleFileUpload(files) {
            if (files.length > 0) {
                const file = files[0];
                
                if (file.size > 5 * 1024 * 1024) {
                    showError('receiptError', 'Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† 5MB');
                    return;
                }
                
                const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg', 'application/pdf'];
                if (!allowedTypes.includes(file.type)) {
                    showError('receiptError', 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø£Ùˆ PDF');
                    return;
                }
                
                uploadedFile = file;
                
                const previewDiv = document.getElementById('filePreview');
                previewDiv.innerHTML = `
                    <div class="file-preview">
                        <div class="file-info">
                            <div class="file-icon">
                                <i class="fas fa-${file.type.includes('image') ? 'file-image' : 'file-pdf'}"></i>
                            </div>
                            <div>
                                <div class="file-name">${file.name}</div>
                                <div class="file-size">${(file.size / 1024).toFixed(1)} ÙƒÙŠÙ„ÙˆØ¨Ø§ÙŠØª</div>
                            </div>
                        </div>
                        <button class="file-remove" onclick="removeUploadedFile()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                previewDiv.style.display = 'block';
                
                document.getElementById('receiptError').style.display = 'none';
                
                formData.payment = {
                    file: file.name,
                    amount: formData.finalAmount || 0
                };
            }
        }

        function removeUploadedFile() {
            uploadedFile = null;
            document.getElementById('receiptFile').value = '';
            document.getElementById('filePreview').style.display = 'none';
            formData.payment = {};
        }

        // ============================================
        // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙÙŠ LocalStorage
        // ============================================
        function saveToLocalStorage(registrationData) {
            try {
                let allRegistrations = JSON.parse(localStorage.getItem('mulhim_registrations') || '[]');
                
                allRegistrations.push(registrationData);
                
                localStorage.setItem('mulhim_registrations', JSON.stringify(allRegistrations));
                
                localStorage.setItem('last_reference', registrationData.reference_id);
                
                return true;
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                return false;
            }
        }

        function getRegistrationFromLocalStorage(referenceId) {
            try {
                const allRegistrations = JSON.parse(localStorage.getItem('mulhim_registrations') || '[]');
                return allRegistrations.find(reg => reg.reference_id === referenceId);
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                return null;
            }
        }

        function getAllRegistrations() {
            try {
                return JSON.parse(localStorage.getItem('mulhim_registrations') || '[]');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª:', error);
                return [];
            }
        }

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Google Sheets
        // ============================================
        async function checkGoogleSheetsConnection() {
            try {
                document.getElementById('loaderText').textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„...';
                document.getElementById('loader').style.display = 'block';
                
                const result = await GoogleSheetsAPI.testConnection();
                
                document.getElementById('loader').style.display = 'none';
                
                if (result.success) {
                    googleSheetsConnected = true;
                    updateConnectionStatus(true, 'âœ… Ù…ØªØµÙ„ Ø¨Ù€ Google Sheets');
                    showMessage('success', 'âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Google Sheets Ù†Ø§Ø¬Ø­');
                    return true;
                } else {
                    googleSheetsConnected = false;
                    updateConnectionStatus(false, 'âš ï¸ ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ù€ Google Sheets');
                    showMessage('warning', 'âš ï¸ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Google Sheets. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ØªØ®Ø²Ù† Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·.');
                    return false;
                }
            } catch (error) {
                console.error('Error checking connection:', error);
                googleSheetsConnected = false;
                updateConnectionStatus(false, 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„');
                return false;
            }
        }

        function updateConnectionStatus(isConnected, message) {
            const connectionStatus = document.getElementById('connectionStatus');
            const connectionText = document.getElementById('connectionText');
            
            connectionStatus.style.display = 'block';
            connectionText.textContent = message;
            
            if (isConnected) {
                connectionStatus.className = 'connection-status connected';
            } else {
                connectionStatus.className = 'connection-status disconnected';
            }
        }

        async function testGoogleSheetsConnection() {
            await checkGoogleSheetsConnection();
        }

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ†
        // ============================================
        async function submitRegistration() {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ·
            if (!document.getElementById('agreeTerms').checked) {
                showError('termsError', 'ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…');
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!formData.studentInfo.name || formData.classes.length === 0 || !uploadedFile) {
                showMessage('error', 'ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§ÙƒØªÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                return;
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø­Ù…Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„
            document.getElementById('loader').style.display = 'block';
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('loaderText').textContent = 'Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Google Sheets...';
            
            let referenceId;
            let storedInGoogle = false;
            let googleResult = null;
            
            try {
                // 1. Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Google Sheets
                if (googleSheetsConnected) {
                    googleResult = await GoogleSheetsAPI.submitRegistration(formData);
                    
                    if (googleResult && googleResult.success) {
                        referenceId = googleResult.reference_id;
                        storedInGoogle = true;
                        showMessage('success', 'âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheets');
                    } else {
                        referenceId = 'MUL-LOCAL-' + Date.now();
                        showMessage('warning', 'âš ï¸ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Google SheetsØŒ Ø³ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹');
                    }
                } else {
                    referenceId = 'MUL-LOCAL-' + Date.now();
                    showMessage('warning', 'âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Google SheetsØŒ Ø³ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹');
                }
                
                // 2. Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ (ÙƒÙ†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©)
                const registrationData = {
                    reference_id: referenceId,
                    timestamp: new Date().toISOString(),
                    studentInfo: formData.studentInfo,
                    classes: formData.classes,
                    payment: formData.payment,
                    totalAmount: formData.totalAmount,
                    finalAmount: formData.finalAmount,
                    discount: formData.discount,
                    status: 'Ù…Ø¹Ù„Ù‚',
                    payment_status: 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯',
                    whatsapp_confirmed: 'Ù„Ø§',
                    confirmation_date: null,
                    stored_in_google: storedInGoogle,
                    google_sync_status: storedInGoogle ? 'synced' : 'failed',
                    google_reference_id: storedInGoogle ? referenceId : null
                };
                
                saveToLocalStorage(registrationData);
                
                // 3. Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                document.getElementById('summaryBeforeSubmit').style.display = 'none';
                
                if (storedInGoogle) {
                    document.getElementById('registrationResult').innerHTML = `
                        <div class="success-message">
                            <div class="success-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <h3>ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰</h3>
                            <p style="color: var(--success);">
                                âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Google Sheets
                                <br>
                                âœ… ØªÙ… Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ø­Ù„ÙŠØ§Ù‹
                            </p>
                            <div class="reference-id">
                                <span>Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹:</span>
                                <strong>${referenceId}</strong>
                            </div>
                            <p style="color: var(--text-light); margin: 15px 0;">
                                Ø³ØªØµÙ„Ùƒ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù…: ${formData.studentInfo.phone}
                                <br>
                                Ø±Ù‚Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„: <strong>92147179</strong>
                            </p>
                            <div class="action-buttons">
                                <button onclick="checkRegistrationStatus('${referenceId}')" 
                                        class="btn btn-primary">
                                    <i class="fas fa-search"></i> ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
                                </button>
                                <button onclick="printReceipt('${referenceId}')" 
                                        class="btn btn-secondary">
                                    <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„
                                </button>
                                <button onclick="resetForm()" 
                                        class="btn btn-success">
                                    <i class="fas fa-plus"></i> ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
                                </button>
                            </div>
                        </div>
                    `;
                    
                } else {
                    document.getElementById('registrationResult').innerHTML = `
                        <div class="success-message">
                            <div class="success-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <h3>ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ù„ÙŠØ§Ù‹ âš ï¸</h3>
                            <p style="color: var(--warning);">
                                ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ ÙÙ‚Ø·
                                <br>
                                Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Google Sheets
                            </p>
                            <div class="reference-id">
                                <span>Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹:</span>
                                <strong>${referenceId}</strong>
                            </div>
                            <p style="color: var(--text-light); margin: 15px 0;">
                                ÙŠÙ…ÙƒÙ†Ùƒ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheets Ù„Ø§Ø­Ù‚Ø§Ù‹
                                <br>
                                Ø±Ù‚Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„: <strong>92147179</strong>
                            </p>
                            <div class="action-buttons">
                                <button onclick="syncWithGoogleSheets('${referenceId}')" 
                                        class="btn btn-primary">
                                    <i class="fas fa-cloud-upload-alt"></i> ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Google Sheets
                                </button>
                                <button onclick="printReceipt('${referenceId}')" 
                                        class="btn btn-secondary">
                                    <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„
                                </button>
                                <button onclick="resetForm()" 
                                        class="btn btn-success">
                                    <i class="fas fa-plus"></i> ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                document.getElementById('registrationResult').style.display = 'block';
                
                // 4. Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†Ù
                setTimeout(() => {
                    resetForm();
                }, 10000);
                
            } catch (error) {
                console.error('Registration error:', error);
                showMessage('error', `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ${error.message}`);
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø²Ø± ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
                document.getElementById('submitBtn').disabled = false;
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        // ============================================
        function showCheckRegistrationModal() {
            document.getElementById('checkModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('checkModal').style.display = 'none';
            document.getElementById('modalResult').innerHTML = '';
        }

        async function checkReference() {
            const referenceId = document.getElementById('referenceInput').value.trim();
            
            if (!referenceId) {
                document.getElementById('modalResult').innerHTML = `
                    <div style="color: #ef4444; padding: 10px; background: rgba(239,68,68,0.1); border-radius: 8px;">
                        <i class="fas fa-exclamation-circle"></i> ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹
                    </div>
                `;
                return;
            }
            
            document.getElementById('modalResult').innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div class="loader-spinner" style="width: 30px; height: 30px; margin: 0 auto;"></div>
                    <p style="color: #666; margin-top: 10px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</p>
                </div>
            `;
            
            setTimeout(async () => {
                await checkRegistrationStatus(referenceId);
            }, 1000);
        }

        async function checkRegistrationStatus(referenceId) {
            // Ø£ÙˆÙ„Ø§Ù‹: Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Google Sheets
            let registration = null;
            let source = '';
            
            if (googleSheetsConnected) {
                const googleResult = await GoogleSheetsAPI.checkRegistration(referenceId);
                
                if (googleResult.success) {
                    registration = googleResult.registration;
                    source = 'Google Sheets';
                }
            }
            
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± ÙÙŠ Google SheetsØŒ Ø§Ø¨Ø­Ø« Ù…Ø­Ù„ÙŠØ§Ù‹
            if (!registration) {
                registration = getRegistrationFromLocalStorage(referenceId);
                source = 'Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ';
            }
            
            if (!registration) {
                document.getElementById('modalResult').innerHTML = `
                    <div style="color: #ef4444; padding: 15px; background: rgba(239,68,68,0.1); border-radius: 8px; text-align: center;">
                        <i class="fas fa-times-circle"></i>
                        <h4 style="margin: 10px 0;">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h4>
                        <p>ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹</p>
                    </div>
                `;
                return;
            }
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
            closeModal();
            
            // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            const statusColor = registration.status === 'Ù…ÙƒØªÙ…Ù„' ? 'var(--success)' : 
                              registration.status === 'Ù…Ø¹Ù„Ù‚' ? 'var(--warning)' : 'var(--danger)';
            
            const paymentColor = registration.payment_status === 'Ù…Ø¤ÙƒØ¯' ? 'var(--success)' : 
                               registration.payment_status === 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯' ? 'var(--warning)' : 'var(--danger)';
            
            document.getElementById('registrationStatus').innerHTML = `
                <div class="summary-card">
                    <h3 style="color: var(--primary-dark); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-clipboard-check"></i> Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                        <span style="font-size: 0.8rem; color: var(--text-light);">(Ù…ØµØ¯Ø±: ${source})</span>
                    </h3>
                    
                    <div class="summary-item">
                        <span>Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹:</span>
                        <span style="direction: ltr;">${registration.reference_id}</span>
                    </div>
                    <div class="summary-item">
                        <span>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</span>
                        <span>${registration.studentInfo ? registration.studentInfo.name : registration.student_name}</span>
                    </div>
                    <div class="summary-item">
                        <span>Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ:</span>
                        <span>${registration.studentInfo ? registration.studentInfo.grade : registration.grade}</span>
                    </div>
                    <div class="summary-item">
                        <span>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</span>
                        <span>${registration.studentInfo ? registration.studentInfo.phone : registration.phone}</span>
                    </div>
                    <div class="summary-item">
                        <span>Ø§Ù„Ø­ØµØµ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</span>
                        <span>${registration.classes ? registration.classes.map(c => c.title).join('ØŒ ') : ''}</span>
                    </div>
                    <div class="summary-item">
                        <span>Ø§Ù„Ù…Ø¨Ù„Øº:</span>
                        <span>${registration.finalAmount || registration.final_amount} Ø±ÙŠØ§Ù„</span>
                    </div>
                    <div class="summary-item">
                        <span>Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</span>
                        <span style="color: ${statusColor}; font-weight: bold;">
                            ${registration.status || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                        </span>
                    </div>
                    <div class="summary-item">
                        <span>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹:</span>
                        <span style="color: ${paymentColor}; font-weight: bold;">
                            ${registration.payment_status || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                        </span>
                    </div>
                    <div class="summary-item">
                        <span>ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:</span>
                        <span>${registration.whatsapp_confirmed || 'Ù„Ø§'}</span>
                    </div>
                    <div class="summary-item">
                        <span>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</span>
                        <span>${new Date(registration.timestamp).toLocaleDateString('ar-OM')}</span>
                    </div>
                    <div class="summary-item">
                        <span>Ù…Ø®Ø²Ù† ÙÙŠ Google Sheets:</span>
                        <span>${registration.stored_in_google ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}</span>
                    </div>
                    
                    <div style="margin-top: 20px; padding-top: 15px; border-top: 2px solid var(--primary-light); text-align: center;">
                        <button onclick="printReceipt('${referenceId}')" class="btn btn-primary">
                            <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„
                        </button>
                        ${!registration.stored_in_google && googleSheetsConnected ? `
                        <button onclick="syncWithGoogleSheets('${referenceId}')" class="btn btn-warning" style="margin-right: 10px;">
                            <i class="fas fa-cloud-upload-alt"></i> ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Google Sheets
                        </button>
                        ` : ''}
                        <button onclick="document.getElementById('registrationStatus').innerHTML = ''" 
                                class="btn btn-secondary" style="margin-right: 10px;">
                            <i class="fas fa-times"></i> Ø¥ØºÙ„Ø§Ù‚
                        </button>
                    </div>
                </div>
            `;
        }

        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
        // ============================================
        function resetForm() {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('basicInfoForm').reset();
            selectedClasses = [];
            uploadedFile = null;
            formData = {
                studentInfo: {},
                classes: [],
                payment: {}
            };
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­ØµØµ
            document.querySelectorAll('.class-item.selected').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù„Ø®Øµ
            updateClassSummary();
            document.getElementById('filePreview').style.display = 'none';
            document.getElementById('agreeTerms').checked = false;
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù„Ø®Øµ
            document.getElementById('summaryBeforeSubmit').style.display = 'block';
            document.getElementById('registrationResult').style.display = 'none';
            document.getElementById('registrationResult').innerHTML = '';
            document.getElementById('registrationStatus').innerHTML = '';
            
            // Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰
            showStep(1);
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ…ÙƒÙŠÙ† Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
            document.getElementById('submitBtn').disabled = false;
            document.getElementById('loader').style.display = 'none';
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
        }

        function showMessage(type, message) {
            const messageDiv = type === 'success' ? 'successMessage' : 
                             type === 'error' ? 'errorMessage' : 'infoMessage';
            const textDiv = type === 'success' ? 'successText' : 
                           type === 'error' ? 'errorText' : 'infoText';
            
            document.getElementById(textDiv).textContent = message;
            document.getElementById(messageDiv).style.display = 'block';
            
            setTimeout(() => {
                document.getElementById(messageDiv).style.display = 'none';
            }, 5000);
        }

        // ============================================
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø³Ø­Ø¨ ÙˆØ¥ÙÙ„Ø§Øª Ø§Ù„Ù…Ù„ÙØ§Øª
        // ============================================
        document.getElementById('uploadArea').addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });

        document.getElementById('uploadArea').addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
        });

        document.getElementById('uploadArea').addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            
            if (e.dataTransfer.files.length) {
                handleFileUpload(e.dataTransfer.files);
            }
        });

        // ============================================
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        // ============================================
        document.addEventListener('DOMContentLoaded', async function() {
            updateProgressBar();
            
            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚ ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰
            document.querySelectorAll('.form-step .btn-secondary')[0].disabled = true;
            
            // Ø¹Ø±Ø¶ Ø¹Ø¯Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© (Ù„Ù„ØªØ¬Ø±Ø¨Ø©)
            const totalRegistrations = getAllRegistrations().length;
            if (totalRegistrations > 0) {
                console.log(`Ø¹Ø¯Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©: ${totalRegistrations}`);
            }
            
            // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Google Sheets
            setTimeout(async () => {
                await checkGoogleSheetsConnection();
            }, 1000);
        });

        // ============================================
        // Ø¯Ø§Ù„Ø© Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„
        // ============================================
        function printReceipt(referenceId) {
            const registration = getRegistrationFromLocalStorage(referenceId);
            
            if (!registration) {
                showMessage('error', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„');
                return;
            }
            
            const receiptWindow = window.open('', '_blank');
            const receiptDate = new Date(registration.timestamp);
            const studentName = registration.studentInfo ? registration.studentInfo.name : '';
            const grade = registration.studentInfo ? registration.studentInfo.grade : '';
            const phone = registration.studentInfo ? registration.studentInfo.phone : '';
            const classes = registration.classes ? registration.classes.map(c => c.title).join('ØŒ ') : '';
            
            receiptWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ar" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <title>Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ - Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…Ù„Ù‡Ù…</title>
                    <style>
                        body { 
                            font-family: 'Cairo', sans-serif; 
                            padding: 20px; 
                            background: #f5f5f5;
                            max-width: 500px;
                            margin: 0 auto;
                        }
                        .receipt {
                            background: white;
                            padding: 30px;
                            border-radius: 15px;
                            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                            border: 2px solid #6a2df3;
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 30px;
                            border-bottom: 2px solid #6a2df3;
                            padding-bottom: 15px;
                        }
                        .header h1 {
                            color: #6a2df3;
                            margin: 0;
                            font-size: 24px;
                        }
                        .header p {
                            color: #666;
                            margin: 5px 0;
                        }
                        .info-item {
                            display: flex;
                            justify-content: space-between;
                            padding: 10px 0;
                            border-bottom: 1px solid #eee;
                        }
                        .info-item:last-child {
                            border-bottom: none;
                            font-weight: bold;
                            color: #6a2df3;
                        }
                        .footer {
                            text-align: center;
                            margin-top: 30px;
                            padding-top: 15px;
                            border-top: 2px solid #6a2df3;
                            color: #666;
                            font-size: 14px;
                        }
                        @media print {
                            body { background: white; padding: 0; }
                            .receipt { box-shadow: none; border: 1px solid #ccc; }
                        }
                    </style>
                </head>
                <body>
                    <div class="receipt">
                        <div class="header">
                            <h1>Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…Ù„Ù‡Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</h1>
                            <p>Ø¥ÙŠØµØ§Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø­Ø¶ÙˆØ±ÙŠØ©</p>
                            <p>${receiptDate.toLocaleDateString('ar-OM')} - ${receiptDate.toLocaleTimeString('ar-OM')}</p>
                        </div>
                        
                        <div class="info-item">
                            <span>Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹:</span>
                            <span>${registration.reference_id}</span>
                        </div>
                        <div class="info-item">
                            <span>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</span>
                            <span>${studentName}</span>
                        </div>
                        <div class="info-item">
                            <span>Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ:</span>
                            <span>${grade}</span>
                        </div>
                        <div class="info-item">
                            <span>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</span>
                            <span>${phone}</span>
                        </div>
                        <div class="info-item">
                            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ:</span>
                            <span>${registration.classes ? registration.classes.length : 0}</span>
                        </div>
                        <div class="info-item">
                            <span>Ø§Ù„Ø­ØµØµ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</span>
                            <span>${classes}</span>
                        </div>
                        <div class="info-item">
                            <span>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                            <span>${registration.totalAmount} Ø±ÙŠØ§Ù„</span>
                        </div>
                        <div class="info-item">
                            <span>Ø§Ù„Ø®ØµÙ…:</span>
                            <span>${registration.discount || 0} Ø±ÙŠØ§Ù„</span>
                        </div>
                        <div class="info-item">
                            <span>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>
                            <span><strong>${registration.finalAmount} Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ</strong></span>
                        </div>
                        <div class="info-item">
                            <span>Ø±Ù‚Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„:</span>
                            <span><strong>92147179</strong></span>
                        </div>
                        
                        <div class="footer">
                            <p>Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ³Ø¬ÙŠÙ„Ùƒ ÙÙŠ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…Ù„Ù‡Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</p>
                            <p>Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª: 95665009</p>
                            <p>Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©: Ø§Ù„Ù†Ù‡Ø¶Ø©ØŒ Ù…Ø³Ù‚Ø·</p>
                            <p style="font-size: 12px; color: #999; margin-top: 10px;">
                                Ù‡Ø°Ø§ Ø§Ù„Ø¥ÙŠØµØ§Ù„ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ - ${new Date().toLocaleDateString('ar-OM')}
                            </p>
                        </div>
                    </div>
                    
                    <script>
                        setTimeout(() => {
                            window.print();
                        }, 500);
                    <\/script>
                </body>
                </html>
            `);
            receiptWindow.document.close();
        }

        // ============================================
        // Ø¯Ø§Ù„Ø© Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ù…Ø¹ Google Sheets
        // ============================================
        async function syncWithGoogleSheets(referenceId) {
            try {
                if (!googleSheetsConnected) {
                    showMessage('error', 'ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ù€ Google Sheets. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„.');
                    return;
                }
                
                showMessage('info', 'Ø¬Ø§Ø±ÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheets...');
                
                const registration = getRegistrationFromLocalStorage(referenceId);
                
                if (!registration) {
                    showMessage('error', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©');
                    return;
                }
                
                const syncData = {
                    student_name: registration.studentInfo.name,
                    grade: registration.studentInfo.grade,
                    phone: registration.studentInfo.phone,
                    email: registration.studentInfo.email || '',
                    notes: registration.studentInfo.notes || '',
                    selected_classes: registration.classes,
                    total_amount: registration.totalAmount,
                    discount: registration.discount || 0,
                    final_amount: registration.finalAmount,
                    payment_file: registration.payment?.file || '',
                    send_notification: false
                };
                
                const result = await GoogleSheetsAPI.submitRegistration(syncData);
                
                if (result.success) {
                    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø­Ù„ÙŠ
                    registration.stored_in_google = true;
                    registration.google_sync_status = 'synced';
                    registration.google_reference_id = result.reference_id;
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    updateLocalRegistration(referenceId, registration);
                    
                    showMessage('success', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheets Ø¨Ù†Ø¬Ø§Ø­!');
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
                    document.getElementById('registrationStatus').innerHTML = `
                        <div class="success-message">
                            <div class="success-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <h3>ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­! âœ…</h3>
                            <p style="color: var(--success);">
                                ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheets
                            </p>
                            <div class="reference-id">
                                <span>Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Google Sheets:</span>
                                <strong>${result.reference_id}</strong>
                            </div>
                            <div class="action-buttons">
                                <button onclick="checkRegistrationStatus('${result.reference_id}')" 
                                        class="btn btn-primary">
                                    <i class="fas fa-search"></i> ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Google Sheets
                                </button>
                                <button onclick="printReceipt('${referenceId}')" 
                                        class="btn btn-secondary">
                                    <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„
                                </button>
                            </div>
                        </div>
                    `;
                    
                } else {
                    showMessage('error', 'ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + (result.error || ''));
                }
                
            } catch (error) {
                console.error('Sync error:', error);
                showMessage('error', `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±: ${error.message}`);
            }
        }

        function updateLocalRegistration(referenceId, updatedData) {
            try {
                const allRegistrations = getAllRegistrations();
                const index = allRegistrations.findIndex(reg => reg.reference_id === referenceId);
                
                if (index !== -1) {
                    allRegistrations[index] = {
                        ...allRegistrations[index],
                        ...updatedData
                    };
                    
                    localStorage.setItem('mulhim_registrations', JSON.stringify(allRegistrations));
                    return true;
                }
                
                return false;
            } catch (error) {
                console.error('Error updating local registration:', error);
                return false;
            }
        }
    </script>
</body>

</html>

